"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[73014],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>h});var n=r(67294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(r),h=i,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||o;return r?n.createElement(m,a(a({ref:t},u),{},{components:r})):n.createElement(m,a({ref:t},u))}));function h(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,a=new Array(o);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var c=2;c<o;c++)a[c]=r[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},24301:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=r(87462),i=(r(67294),r(3905));const o={title:"Pod Security Policies"},a=void 0,s={unversionedId:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies",id:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies",title:"Pod Security Policies",description:"Pod Security Policy is only available in Kubernetes until v1.24. Pod Security Standards are the built-in alternative.",source:"@site/docs/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies.md",sourceDirName:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration",slug:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies.md",tags:[],version:"current",lastUpdatedAt:1678743484,formattedLastUpdatedAt:"Mar 13, 2023",frontMatter:{title:"Pod Security Policies"},sidebar:"tutorialSidebar",previous:{title:"Example Scenarios",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/about-rke1-templates/example-use-cases"},next:{title:"Pod Security Standards (PSS) & Pod Security Admission (PSA)",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/pod-security-standards"}},l={},c=[{value:"How PSPs Work",id:"how-psps-work",level:2},{value:"Default PSPs",id:"default-psps",level:2},{value:"Restricted-NoRoot",id:"restricted-noroot",level:3},{value:"Restricted",id:"restricted",level:3},{value:"Unrestricted",id:"unrestricted",level:3},{value:"Creating PSPs",id:"creating-psps",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Creating PSPs in the Rancher UI",id:"creating-psps-in-the-rancher-ui",level:3},{value:"Configuration",id:"configuration",level:2}],u={toc:c};function p(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Pod Security Policy is only available in Kubernetes until v1.24. ",(0,i.kt)("a",{parentName:"p",href:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/pod-security-standards"},"Pod Security Standards")," are the built-in alternative.")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/security/pod-security-policy/"},"Pod Security Policies (PSPs)")," are objects that control security-sensitive aspects of the pod specification (such as root privileges)."),(0,i.kt)("p",null,"If a pod doesn't meet the conditions specified in the PSP, Kubernetes won't allow it to start, and Rancher will display the following error message: ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod <NAME> is forbidden: unable to validate..."),"."),(0,i.kt)("h2",{id:"how-psps-work"},"How PSPs Work"),(0,i.kt)("p",null,"You can assign PSPs at the cluster or project level."),(0,i.kt)("p",null,"PSPs work through inheritance:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"By default, PSPs assigned to a cluster are inherited by its projects, as well as any namespaces added to those projects."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Exception:")," Namespaces that are not assigned to projects do not inherit PSPs, regardless of whether the PSP is assigned to a cluster or project. Because these namespaces have no PSPs, workload deployments to these namespaces will fail, which is the default Kubernetes behavior."),(0,i.kt)("li",{parentName:"ul"},"You can override the default PSP by assigning a different PSP directly to the project.")),(0,i.kt)("p",null,"Any workloads that are already running in a cluster or project before a PSP is assigned will not be checked if it complies with the PSP. Workloads would need to be cloned or upgraded to see if they pass the PSP."),(0,i.kt)("p",null,"Read more about Pod Security Policies in the ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/policy/pod-security-policy/"},"Kubernetes documentation"),"."),(0,i.kt)("h2",{id:"default-psps"},"Default PSPs"),(0,i.kt)("p",null,"Rancher ships with three default Pod Security Policies (PSPs): the ",(0,i.kt)("inlineCode",{parentName:"p"},"restricted-noroot"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"restricted")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"unrestricted")," policies."),(0,i.kt)("h3",{id:"restricted-noroot"},"Restricted-NoRoot"),(0,i.kt)("p",null,"This policy is based on the Kubernetes ",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/policy/restricted-psp.yaml"},"example restricted policy"),". It significantly restricts what types of pods can be deployed to a cluster or project. This policy:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Prevents pods from running as a privileged user and prevents escalation of privileges."),(0,i.kt)("li",{parentName:"ul"},"Validates that server-required security mechanisms are in place, such as restricting what volumes can be mounted to only the core volume types and preventing root supplemental groups from being added.")),(0,i.kt)("h3",{id:"restricted"},"Restricted"),(0,i.kt)("p",null,"This policy is a relaxed version of the ",(0,i.kt)("inlineCode",{parentName:"p"},"restricted-noroot")," policy, with almost all the restrictions in place, except for the fact that it allows running containers as a privileged user."),(0,i.kt)("h3",{id:"unrestricted"},"Unrestricted"),(0,i.kt)("p",null,"This policy is equivalent to running Kubernetes with the PSP controller disabled. It has no restrictions on what pods can be deployed into a cluster or project."),(0,i.kt)("admonition",{title:"important",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"When disabling PSPs, default PSPs are ",(0,i.kt)("strong",{parentName:"p"},"not")," automatically deleted from your cluster. You must manually delete them if they're no longer needed.")),(0,i.kt)("h2",{id:"creating-psps"},"Creating PSPs"),(0,i.kt)("p",null,"Using Rancher, you can create a Pod Security Policy using our GUI rather than creating a YAML file."),(0,i.kt)("h3",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"Rancher can only assign PSPs for clusters that are ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/launch-kubernetes-with-rancher"},"launched using RKE"),"."),(0,i.kt)("p",null,"You must enable PSPs at the cluster level before you can assign them to a project. This can be configured by ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/cluster-configuration"},"editing the cluster"),"."),(0,i.kt)("p",null,"It is a best practice to set PSP at the cluster level."),(0,i.kt)("p",null,"We recommend adding PSPs during cluster and project creation instead of adding it to an existing one."),(0,i.kt)("h3",{id:"creating-psps-in-the-rancher-ui"},"Creating PSPs in the Rancher UI"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,i.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,i.kt)("li",{parentName:"ol"},"In the left navigation bar, click ",(0,i.kt)("strong",{parentName:"li"},"Pod Security Policies"),"."),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Add Policy"),"."),(0,i.kt)("li",{parentName:"ol"},"Name the policy."),(0,i.kt)("li",{parentName:"ol"},"Complete each section of the form. Refer to the ",(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/policy/pod-security-policy/"},"Kubernetes documentation")," for more information on what each policy does."),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Create"),".")),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"The Kubernetes documentation on PSPs is ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/policy/pod-security-policy/"},"here"),"."))}p.isMDXComponent=!0}}]);